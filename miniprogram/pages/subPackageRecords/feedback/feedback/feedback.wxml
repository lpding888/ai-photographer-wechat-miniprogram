<!-- ç”¨æˆ·åé¦ˆé¡µé¢ -->
<view class="feedback-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ’¬ æ„è§åé¦ˆ</text>
    <text class="page-subtitle">æ‚¨çš„å»ºè®®æ˜¯æˆ‘ä»¬å‰è¿›çš„åŠ¨åŠ›</text>
  </view>

  <!-- åé¦ˆç±»å‹é€‰æ‹© -->
  <view class="section">
    <view class="section-title">åé¦ˆç±»å‹</view>
    <view class="feedback-types">
      <view
        class="type-item {{selectedType === item.id ? 'selected' : ''}}"
        wx:for="{{feedbackTypes}}"
        wx:key="id"
        bindtap="selectFeedbackType"
        data-type="{{item.id}}"
      >
        <text class="type-icon">{{item.icon}}</text>
        <view class="type-content">
          <text class="type-label">{{item.label}}</text>
          <text class="type-description">{{item.description}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åé¦ˆå†…å®¹ -->
  <view class="section">
    <view class="section-title">è¯¦ç»†æè¿°</view>
    <textarea
      class="feedback-textarea"
      placeholder="è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜æˆ–å»ºè®®ï¼ŒåŒ…æ‹¬æ“ä½œæ­¥éª¤ã€æœŸæœ›ç»“æœç­‰..."
      value="{{feedbackContent}}"
      bindinput="onFeedbackInput"
      maxlength="1000"
      show-confirm-bar="{{false}}"
    />
    <view class="char-count">{{feedbackContent.length}}/1000</view>
  </view>

  <!-- è”ç³»æ–¹å¼ -->
  <view class="section">
    <view class="section-title">è”ç³»æ–¹å¼ <text class="optional">(å¯é€‰)</text></view>
    <input
      class="contact-input"
      placeholder="å¾®ä¿¡å·ã€æ‰‹æœºå·æˆ–é‚®ç®±ï¼Œä¾¿äºæˆ‘ä»¬è”ç³»æ‚¨"
      value="{{contactInfo}}"
      bindinput="onContactInput"
      maxlength="50"
    />
  </view>

  <!-- é™„ä»¶ä¸Šä¼  -->
  <view class="section">
    <view class="section-title">
      <text>ç›¸å…³å›¾ç‰‡/è§†é¢‘</text>
      <text class="optional">(æœ€å¤š{{maxAttachments}}ä¸ª)</text>
    </view>

    <view class="attachments-container">
      <!-- å·²ä¸Šä¼ çš„é™„ä»¶ -->
      <view
        class="attachment-item"
        wx:for="{{attachments}}"
        wx:key="id"
        data-index="{{index}}"
        bindtap="previewAttachment"
      >
        <image
          wx:if="{{item.type === 'image'}}"
          class="attachment-preview"
          src="{{item.path}}"
          mode="aspectFill"
        />
        <view wx:elif="{{item.type === 'video'}}" class="attachment-preview video">
          <text class="video-icon">ğŸ¬</text>
          <text class="video-duration">{{item.duration}}s</text>
        </view>

        <view class="attachment-info">
          <text class="attachment-size">{{formatFileSize(item.size)}}</text>
        </view>

        <button
          class="remove-btn"
          bindtap="removeAttachment"
          data-index="{{index}}"
          catchtap="stopPropagation"
        >Ã—</button>
      </view>

      <!-- æ·»åŠ é™„ä»¶æŒ‰é’® -->
      <view
        wx:if="{{attachments.length < maxAttachments}}"
        class="add-attachment-btn"
        bindtap="addAttachment"
      >
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ å›¾ç‰‡/è§†é¢‘</text>
      </view>
    </view>
  </view>

  <!-- æ€§èƒ½æ•°æ®é€‰é¡¹ -->
  <view class="section">
    <view class="option-item">
      <view class="option-content">
        <text class="option-title">åŒ…å«æ€§èƒ½æ•°æ®</text>
        <text class="option-description">å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°è¯Šæ–­æ€§èƒ½é—®é¢˜</text>
      </view>
      <switch
        checked="{{includePerformanceData}}"
        bindchange="togglePerformanceData"
        color="#667eea"
      />
    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view class="submit-section">
    <button
      class="submit-btn {{submitting ? 'submitting' : ''}}"
      bindtap="submitFeedback"
      disabled="{{submitting}}"
    >
      <text wx:if="{{submitting}}">æäº¤ä¸­...</text>
      <text wx:else>æäº¤åé¦ˆ</text>
    </button>
  </view>

  <!-- å†å²åé¦ˆ -->
  <view class="section history-section">
    <view class="section-title" bindtap="toggleHistory">
      <text>å†å²åé¦ˆ</text>
      <text class="toggle-icon">{{showHistory ? 'â–¼' : 'â–¶'}}</text>
    </view>

    <view class="feedback-history" wx:if="{{showHistory}}">
      <view
        class="history-item"
        wx:for="{{feedbackHistory}}"
        wx:key="_id"
        data-index="{{index}}"
        bindtap="viewHistoryDetail"
      >
        <view class="history-header">
          <text class="history-type">{{getFeedbackTypeInfo(item.type).label}}</text>
          <text class="history-date">{{item.created_at}}</text>
        </view>
        <text class="history-content">{{item.content}}</text>
        <view class="history-status {{item.status || 'pending'}}">
          <text>{{item.status === 'resolved' ? 'å·²è§£å†³' : item.status === 'in_progress' ? 'å¤„ç†ä¸­' : 'å¾…å¤„ç†'}}</text>
        </view>
      </view>

      <view wx:if="{{feedbackHistory.length === 0}}" class="empty-history">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— å†å²åé¦ˆ</text>
      </view>
    </view>
  </view>
</view>