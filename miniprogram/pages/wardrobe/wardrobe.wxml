<!--æˆ‘çš„è¡£æŸœ - æ™ºèƒ½ç®¡ç†ç‰ˆ-->
<wxs module="utils" src="./wardrobe.wxs"></wxs>
<view class="wardrobe-container">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <text class="title">æˆ‘çš„è¡£æŸœ</text>
    <view class="header-action" bindtap="onShowSearch">
      <text class="action-icon">ğŸ”</text>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰æ  -->
  <scroll-view class="category-scroll" scroll-x enable-flex>
    <view class="category-list">
      <view
        class="category-item {{currentCategory === item.key ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="key"
        bindtap="switchCategory"
        data-category="{{item.key}}"
      >
        <text class="category-icon">{{item.icon}}</text>
        <text class="category-name">{{item.label}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- è¡£ç‰©å±•ç¤ºåŒº -->
  <view class="content-area">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{clothingList.length === 0 && !loading}}">
      <view class="empty-icon">ğŸ‘”</view>
      <text class="empty-title">è¡£æŸœç©ºç©ºå¦‚ä¹Ÿ</text>
      <text class="empty-hint">å¿«æ¥æ·»åŠ ç¬¬ä¸€ä»¶è¡£ç‰©å§~</text>
      <view class="empty-tip">
        <text>ğŸ’¡ æç¤ºï¼šç‚¹å‡»å³ä¸‹è§’çš„ + æŒ‰é’®å¼€å§‹æ·»åŠ </text>
      </view>
    </view>

    <!-- è¡£ç‰©ç½‘æ ¼ -->
    <view class="clothes-grid" wx:else>
      <view
        class="clothes-item"
        wx:for="{{clothingList}}"
        wx:key="id"
        bindtap="onClothesClick"
        data-item="{{item}}"
        bindlongpress="onClothesLongPress"
        data-id="{{item.id}}"
      >
        <!-- è¡£ç‰©å›¾ç‰‡å®¹å™¨ -->
        <view class="clothes-image-wrapper">
          <image
            class="clothes-image"
            src="{{item.processedImage || item.url}}"
            mode="aspectFit"
            lazy-load
          ></image>

          <!-- å¸¸ç©¿æ ‡è®° -->
          <view class="favorite-badge" wx:if="{{item.isFavorite}}">â­</view>
        </view>

        <!-- è¡£ç‰©ä¿¡æ¯ -->
        <view class="clothes-info">
          <text class="clothes-name">{{item.name || 'æœªå‘½å'}}</text>
          <view class="clothes-meta">
            <text class="clothes-category">{{utils.getCategoryName(item.category)}}</text>
            <text class="use-count" wx:if="{{item.useCount > 0}}">ç©¿è¿‡{{item.useCount}}æ¬¡</text>
          </view>
          <view class="clothes-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
              #{{tag}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® (FAB) -->
  <view class="fab" bindtap="onAddClothes">
    <text class="fab-icon">+</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- æœç´¢å¼¹çª— -->
<view class="search-modal {{showSearch ? 'show' : ''}}" catchtap="onCloseSearch">
  <view class="search-content" catchtap="stopPropagation">
    <view class="search-input-wrapper">
      <text class="search-icon-input">ğŸ”</text>
      <input
        class="search-input"
        placeholder="æœç´¢è¡£ç‰©åç§°ã€æ ‡ç­¾..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearchConfirm"
        focus="{{showSearch}}"
      />
      <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="onClearSearch">Ã—</view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <view class="search-results" wx:if="{{searchKeyword}}">
      <view class="result-count">æ‰¾åˆ° {{searchResults.length}} ä»¶è¡£ç‰©</view>
      <view class="result-list">
        <view
          class="result-item"
          wx:for="{{searchResults}}"
          wx:key="id"
          bindtap="onSearchResultClick"
          data-item="{{item}}"
        >
          <image class="result-image" src="{{item.processedImage || item.url}}" mode="aspectFit"></image>
          <view class="result-info">
            <text class="result-name">{{item.name}}</text>
            <text class="result-category">{{utils.getCategoryName(item.category)}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æœç´¢å†å² -->
    <view class="search-history" wx:if="{{!searchKeyword && searchHistory.length > 0}}">
      <view class="history-header">
        <text class="history-title">æœç´¢å†å²</text>
        <text class="history-clear" bindtap="onClearHistory">æ¸…ç©º</text>
      </view>
      <view class="history-list">
        <view
          class="history-item"
          wx:for="{{searchHistory}}"
          wx:key="*this"
          bindtap="onHistoryClick"
          data-keyword="{{item}}"
        >
          <text class="history-icon">ğŸ•</text>
          <text class="history-text">{{item}}</text>
        </view>
      </view>
    </view>

    <view class="search-cancel" bindtap="onCloseSearch">å–æ¶ˆ</view>
  </view>
</view>
