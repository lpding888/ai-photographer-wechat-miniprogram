<!--我的衣柜 - 智能管理版-->
<wxs module="utils" src="./wardrobe.wxs"></wxs>
<view class="wardrobe-container">
  <!-- 顶部标题栏 -->
  <view class="header">
    <text class="title">我的衣柜</text>
    <view class="header-action" bindtap="onShowSearch">
      <text class="action-icon">🔍</text>
    </view>
  </view>

  <!-- 分类筛选栏 -->
  <scroll-view class="category-scroll" scroll-x enable-flex>
    <view class="category-list">
      <view
        class="category-item {{currentCategory === item.key ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="key"
        bindtap="switchCategory"
        data-category="{{item.key}}"
      >
        <text class="category-icon">{{item.icon}}</text>
        <text class="category-name">{{item.label}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- 衣物展示区 -->
  <view class="content-area">
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{clothingList.length === 0 && !loading}}">
      <view class="empty-icon">👔</view>
      <text class="empty-title">衣柜空空如也</text>
      <text class="empty-hint">快来添加第一件衣物吧~</text>
      <view class="empty-tip">
        <text>💡 提示：点击右下角的 + 按钮开始添加</text>
      </view>
    </view>

    <!-- 衣物网格 -->
    <view class="clothes-grid" wx:else>
      <view
        class="clothes-item"
        wx:for="{{clothingList}}"
        wx:key="id"
        bindtap="onClothesClick"
        data-item="{{item}}"
        bindlongpress="onClothesLongPress"
        data-id="{{item.id}}"
      >
        <!-- 衣物图片容器 -->
        <view class="clothes-image-wrapper">
          <image
            class="clothes-image"
            src="{{item.processedImage || item.url}}"
            mode="aspectFit"
            lazy-load
          ></image>

          <!-- 常穿标记 -->
          <view class="favorite-badge" wx:if="{{item.isFavorite}}">⭐</view>
        </view>

        <!-- 衣物信息 -->
        <view class="clothes-info">
          <text class="clothes-name">{{item.name || '未命名'}}</text>
          <view class="clothes-meta">
            <text class="clothes-category">{{utils.getCategoryName(item.category)}}</text>
            <text class="use-count" wx:if="{{item.useCount > 0}}">穿过{{item.useCount}}次</text>
          </view>
          <view class="clothes-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
              #{{tag}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 悬浮添加按钮 (FAB) -->
  <view class="fab" bindtap="onAddClothes">
    <text class="fab-icon">+</text>
  </view>

  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>

<!-- 搜索弹窗 -->
<view class="search-modal {{showSearch ? 'show' : ''}}" catchtap="onCloseSearch">
  <view class="search-content" catchtap="stopPropagation">
    <view class="search-input-wrapper">
      <text class="search-icon-input">🔍</text>
      <input
        class="search-input"
        placeholder="搜索衣物名称、标签..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearchConfirm"
        focus="{{showSearch}}"
      />
      <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="onClearSearch">×</view>
    </view>

    <!-- 搜索结果 -->
    <view class="search-results" wx:if="{{searchKeyword}}">
      <view class="result-count">找到 {{searchResults.length}} 件衣物</view>
      <view class="result-list">
        <view
          class="result-item"
          wx:for="{{searchResults}}"
          wx:key="id"
          bindtap="onSearchResultClick"
          data-item="{{item}}"
        >
          <image class="result-image" src="{{item.processedImage || item.url}}" mode="aspectFit"></image>
          <view class="result-info">
            <text class="result-name">{{item.name}}</text>
            <text class="result-category">{{utils.getCategoryName(item.category)}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索历史 -->
    <view class="search-history" wx:if="{{!searchKeyword && searchHistory.length > 0}}">
      <view class="history-header">
        <text class="history-title">搜索历史</text>
        <text class="history-clear" bindtap="onClearHistory">清空</text>
      </view>
      <view class="history-list">
        <view
          class="history-item"
          wx:for="{{searchHistory}}"
          wx:key="*this"
          bindtap="onHistoryClick"
          data-keyword="{{item}}"
        >
          <text class="history-icon">🕐</text>
          <text class="history-text">{{item}}</text>
        </view>
      </view>
    </view>

    <view class="search-cancel" bindtap="onCloseSearch">取消</view>
  </view>
</view>
